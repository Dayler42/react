================================================================================
DOCUMENTACI√ìN DEL COMPONENTE NuevaTarea.jsx
================================================================================

Este documento explica cada funci√≥n, constante y secci√≥n del c√≥digo del componente
NuevaTarea.jsx, que permite crear nuevas tareas con asignaci√≥n m√∫ltiple de estudiantes.

================================================================================
IMPORTS Y DEPENDENCIAS
================================================================================

L√≠neas 1-3: Importaciones necesarias
-------------------------------------
- useState: Hook de React para manejar el estado del componente
- boardsAPI, listsAPI, cardsAPI, labelsAPI: Funciones de la API para interactuar
  con el backend (tableros, listas, tarjetas y etiquetas)
- useTheme: Hook personalizado para obtener el tema actual (claro/oscuro)

================================================================================
CONSTANTES
================================================================================

L√≠neas 6-13: ETIQUETAS_PREDEFINIDAS
------------------------------------
Constante que define las etiquetas predefinidas disponibles en el sistema:
- Examen (rojo oscuro #d32f2f, icono üìù)
- Entrega Obligatoria (rojo #f44336, icono ‚ö†Ô∏è)
- Importante (naranja #ff9800, icono üî¥)
- Proyecto (morado #9c27b0, icono üìä)
- Pr√°ctica (azul #2196f3, icono üíª)
- Lectura (verde #4caf50, icono üìñ)

Cada etiqueta tiene un nombre, color hexadecimal e icono emoji.

================================================================================
FUNCI√ìN PRINCIPAL: NuevaTarea
================================================================================

L√≠nea 15: Declaraci√≥n del componente
--------------------------------------
function NuevaTarea({ setTareas, cursoId, estudiantes, usuario, onActividad, 
                     listsMap, boardId, onTareaCreada, etiquetas = [] })

Par√°metros recibidos:
- setTareas: Funci√≥n para actualizar el estado de las tareas
- cursoId: ID del curso actual
- estudiantes: Array de estudiantes disponibles
- usuario: Objeto con informaci√≥n del usuario actual (incluye rol)
- onActividad: Callback para registrar actividades/eventos
- listsMap: Mapa de listas del tablero (pendiente, progreso, completada)
- boardId: ID del tablero actual
- onTareaCreada: Callback que se ejecuta despu√©s de crear una tarea
- etiquetas: Array de etiquetas disponibles (por defecto vac√≠o)

================================================================================
ESTADOS DEL COMPONENTE (useState)
================================================================================

L√≠nea 16: useTheme()
--------------------
Obtiene el tema actual (isDark: true/false) para aplicar estilos seg√∫n el modo.

L√≠nea 17: texto
--------------
const [texto, setTexto] = useState('');
Estado para almacenar el t√≠tulo de la tarea que el usuario est√° escribiendo.

L√≠nea 18: descripcion
---------------------
const [descripcion, setDescripcion] = useState('');
Estado para almacenar la descripci√≥n opcional de la tarea.

L√≠nea 19: estudiantesSeleccionados
----------------------------------
const [estudiantesSeleccionados, setEstudiantesSeleccionados] = useState([]);
Estado que almacena un array con los IDs de los estudiantes seleccionados.
Permite selecci√≥n m√∫ltiple mediante checkboxes.

L√≠nea 20: fechaVencimiento
--------------------------
const [fechaVencimiento, setFechaVencimiento] = useState('');
Estado para almacenar la fecha de vencimiento de la tarea (formato YYYY-MM-DD).

L√≠nea 21: etiquetasSeleccionadas
--------------------------------
const [etiquetasSeleccionadas, setEtiquetasSeleccionadas] = useState([]);
Estado que almacena un array con los IDs de las etiquetas seleccionadas.

L√≠nea 22: creandoEtiqueta
-------------------------
const [creandoEtiqueta, setCreandoEtiqueta] = useState(false);
Estado booleano que controla si se est√° mostrando el formulario para crear
una nueva etiqueta.

L√≠nea 23: nombreNuevaEtiqueta
------------------------------
const [nombreNuevaEtiqueta, setNombreNuevaEtiqueta] = useState('');
Estado para almacenar el nombre de la etiqueta que se est√° creando.

L√≠nea 24: colorNuevaEtiqueta
-----------------------------
const [colorNuevaEtiqueta, setColorNuevaEtiqueta] = useState('#3498db');
Estado para almacenar el color seleccionado para la nueva etiqueta
(por defecto azul #3498db).

================================================================================
VARIABLES DERIVADAS
================================================================================

L√≠nea 26: estudiantesDelCurso
------------------------------
const estudiantesDelCurso = estudiantes?.filter(e => e.cursoId === cursoId) || [];

Filtra los estudiantes para mostrar solo los que pertenecen al curso actual.
- Usa optional chaining (?.) para evitar errores si estudiantes es null/undefined
- Compara el cursoId de cada estudiante con el cursoId actual
- Retorna array vac√≠o si no hay estudiantes

================================================================================
FUNCI√ìN: agregar()
================================================================================

L√≠neas 28-150: Funci√≥n as√≠ncrona principal para crear tareas
--------------------------------------------------------------

Esta funci√≥n se ejecuta cuando el usuario hace clic en "Agregar Tarea" o presiona
Enter en el campo de t√≠tulo.

PROCESO PASO A PASO:

1. Validaci√≥n inicial (L√≠nea 29)
   - Verifica que el texto de la tarea no est√© vac√≠o (despu√©s de trim)

2. Preparaci√≥n de estudiantes (L√≠neas 31-33)
   - Si hay estudiantes seleccionados, los usa
   - Si no hay estudiantes seleccionados, crea un array con [null] para crear
     una tarea sin asignar

3. Gesti√≥n del Board/Tablero (L√≠neas 36-81)
   
   a) Si existe boardId y listsMap (L√≠neas 40-43):
      - Usa el tablero y lista existentes
      - Obtiene el ID de la lista "Pendiente" desde listsMap
   
   b) Si no existe (L√≠neas 44-80):
      - Obtiene todos los boards disponibles (L√≠nea 46)
      - Si hay boards, usa el primero (L√≠nea 47)
      - Si no hay boards y hay cursoId, crea uno nuevo con el nombre del curso
        (L√≠neas 50-52)
      - Si no se puede obtener o crear el board, lanza un error (L√≠neas 55-57)
      - Obtiene todas las listas del board (L√≠nea 60)
      - Busca la lista "Pendiente" (L√≠neas 61-64)
      - Si no existe, la crea (L√≠neas 67-78)

4. Creaci√≥n de tareas (L√≠neas 83-123)
   
   Para cada estudiante seleccionado (o null si no hay ninguno):
   
   a) Prepara los datos de la card (L√≠neas 87-95):
      - list: ID de la lista "Pendiente"
      - title: T√≠tulo de la tarea (texto.trim())
      - description: Descripci√≥n de la tarea (descripcion.trim())
      - assigned_to_id: ID del estudiante (convertido a entero) o null
      - due_date: Fecha de vencimiento o null
      - position: 0 (posici√≥n inicial)
      - label_ids: Array de IDs de etiquetas seleccionadas
   
   b) Crea la card en el backend (L√≠nea 97):
      - Llama a cardsAPI.create() con los datos preparados
      - Espera la respuesta del servidor
   
   c) Busca informaci√≥n del estudiante (L√≠neas 100-102):
      - Si hay estudianteId, busca el estudiante en estudiantesDelCurso
      - Compara userId o id seg√∫n est√© disponible
   
   d) Crea objeto de tarea local (L√≠neas 105-113):
      - id: ID de la card creada en el backend
      - texto: T√≠tulo de la card
      - descripcion: Descripci√≥n de la card
      - asignadoA: Nombre del usuario asignado (username o first_name)
      - asignadoAId: ID del usuario asignado
      - fechaVencimiento: Fecha de vencimiento
      - cursoId: ID del curso actual
   
   e) Agrega la tarea al array tareasCreadas (L√≠nea 115)
   
   f) Registra la actividad (L√≠neas 117-122):
      - Si existe onActividad, llama al callback con informaci√≥n del evento
      - Incluye mensaje descriptivo y datos de la tarea

5. Actualizaci√≥n del estado local (L√≠neas 126-129)
   - Agrega todas las tareas creadas al estado pendiente
   - Usa spread operator para mantener las tareas existentes

6. Notificaci√≥n al componente padre (L√≠neas 131-134)
   - Si existe onTareaCreada, lo ejecuta para que el padre recargue las tareas
     desde el backend

7. Limpieza del formulario (L√≠neas 136-144)
   - Resetea todos los campos a sus valores iniciales:
     * texto: ''
     * descripcion: ''
     * estudiantesSeleccionados: []
     * fechaVencimiento: ''
     * etiquetasSeleccionadas: []
     * creandoEtiqueta: false
     * nombreNuevaEtiqueta: ''
     * colorNuevaEtiqueta: '#3498db'

8. Manejo de errores (L√≠neas 145-148)
   - Captura cualquier error durante el proceso
   - Registra el error en la consola
   - Muestra un alert al usuario con mensaje de error

================================================================================
RENDERIZADO DEL COMPONENTE (return)
================================================================================

L√≠neas 152-514: JSX que se renderiza en la interfaz
----------------------------------------------------

CONTENEDOR PRINCIPAL (L√≠neas 153-164)
--------------------------------------
Div principal con estilos din√°micos seg√∫n el tema:
- Fondo oscuro (#2d2d2d) o claro (white)
- Padding, border-radius, box-shadow
- Ancho m√°ximo de 800px, centrado
- Transiciones suaves para cambios de tema

T√çTULO (L√≠neas 165-167)
------------------------
Encabezado "‚ûï Nueva Tarea" con estilos seg√∫n el tema.

CAMPO DE T√çTULO (L√≠neas 169-186)
---------------------------------
Input de texto para el t√≠tulo de la tarea:
- Placeholder: "T√≠tulo de la tarea..."
- Valor controlado por estado 'texto'
- onChange: Actualiza el estado 'texto'
- onKeyPress: Si presiona Enter, ejecuta agregar()
- Estilos adaptativos seg√∫n tema

CAMPO DE DESCRIPCI√ìN (L√≠neas 188-206)
--------------------------------------
Textarea para la descripci√≥n opcional:
- Placeholder: "Descripci√≥n de la tarea (opcional)..."
- Valor controlado por estado 'descripcion'
- onChange: Actualiza el estado 'descripcion'
- Altura m√≠nima de 60px, redimensionable verticalmente
- Estilos adaptativos seg√∫n tema

GRID DE ASIGNACI√ìN Y FECHA (L√≠neas 208-292)
--------------------------------------------
Contenedor con dos columnas usando CSS Grid:

COLUMNA 1: SELECTOR DE ESTUDIANTES (L√≠neas 209-270)
----------------------------------------------------
Solo visible si:
- usuario.rol === 'docente'
- estudiantesDelCurso.length > 0

a) Label (L√≠neas 211-213):
   "Asignar a (puedes seleccionar varios):"

b) Contenedor con scroll (L√≠neas 214-222):
   - Altura m√°xima de 150px
   - Scroll vertical si hay muchos estudiantes
   - Estilos adaptativos seg√∫n tema

c) Mapeo de estudiantes (L√≠neas 223-257):
   Para cada estudiante del curso:
   - Calcula el ID del estudiante (userId o id)
   - Verifica si est√° seleccionado
   - Renderiza un label con checkbox:
     * Checkbox (L√≠neas 238-252):
       - Tipo checkbox
       - Estado checked seg√∫n estaSeleccionado
       - onChange: Agrega o quita el ID del array estudiantesSeleccionados
     * Nombre del estudiante (L√≠nea 254)

d) Contador de seleccionados (L√≠neas 259-268):
   - Solo visible si hay estudiantes seleccionados
   - Muestra cantidad y pluraliza correctamente
   - Color verde para indicar selecci√≥n

COLUMNA 2: FECHA DE VENCIMIENTO (L√≠neas 272-291)
-------------------------------------------------
Input de tipo date:
- Label: "Fecha de vencimiento:"
- Valor controlado por estado 'fechaVencimiento'
- onChange: Actualiza el estado 'fechaVencimiento'
- Estilos adaptativos seg√∫n tema

SELECTOR DE ETIQUETAS (L√≠neas 294-496)
---------------------------------------
Solo visible si usuario.rol === 'docente'

a) Label (L√≠neas 297-305):
   "üè∑Ô∏è Etiquetas:" con estilos destacados

b) Etiquetas disponibles (L√≠neas 308-363):
   Solo se muestra si hay etiquetas disponibles
   
   - Contenedor flex (L√≠neas 309-317):
     * Display flex con wrap
     * Gap de 8px entre etiquetas
     * Fondo adaptativo seg√∫n tema
   
   - Mapeo de etiquetas (L√≠neas 318-361):
     Para cada etiqueta:
     * Verifica si est√° seleccionada
     * Busca si es una etiqueta predefinida (para mostrar icono)
     * Renderiza bot√≥n (L√≠neas 322-359):
       - onClick: Agrega o quita el ID del array etiquetasSeleccionadas
       - Estilos din√°micos:
         * Si est√° seleccionada: fondo del color de la etiqueta, texto blanco
         * Si no est√° seleccionada: fondo transparente, texto del color
       - Muestra icono si es predefinida
       - Muestra c√≠rculo de color
       - Muestra nombre de la etiqueta
       - Muestra ‚úì si est√° seleccionada

c) Crear nueva etiqueta (L√≠neas 365-494):
   
   Si creandoEtiqueta === false (L√≠neas 366-382):
   - Bot√≥n "‚ûï Crear nueva etiqueta"
   - onClick: Cambia creandoEtiqueta a true
   
   Si creandoEtiqueta === true (L√≠neas 383-494):
   - Formulario para crear etiqueta:
     * Input de nombre (L√≠neas 390-406):
       - Placeholder: "Nombre de la etiqueta..."
       - Valor controlado por nombreNuevaEtiqueta
       - onChange: Actualiza nombreNuevaEtiqueta
     
     * Selector de color (L√≠neas 407-423):
       - Input tipo color
       - Valor controlado por colorNuevaEtiqueta
       - onChange: Actualiza colorNuevaEtiqueta
       - Texto explicativo
     
     * Botones (L√≠neas 424-492):
       - Bot√≥n "Crear" (L√≠neas 425-471):
         * onClick: Funci√≥n as√≠ncrona que:
           - Valida que el nombre no est√© vac√≠o
           - Valida que haya boardId
           - Crea la etiqueta usando labelsAPI.create()
           - Agrega el ID de la nueva etiqueta a etiquetasSeleccionadas
           - Resetea el formulario
           - Ejecuta onTareaCreada si existe
           - Maneja errores con try/catch
       
       - Bot√≥n "Cancelar" (L√≠neas 472-491):
         * onClick: Resetea el formulario sin crear la etiqueta

BOT√ìN AGREGAR TAREA (L√≠neas 498-512)
-------------------------------------
Bot√≥n principal para crear la tarea:
- Texto: "Agregar Tarea"
- onClick: Ejecuta la funci√≥n agregar()
- Estilos: Fondo verde (#4caf50), texto blanco, padding, border-radius
- Cursor pointer, fuente en negrita

================================================================================
EXPORTACI√ìN
================================================================================

L√≠nea 517: export default NuevaTarea;
--------------------------------------
Exporta el componente como exportaci√≥n por defecto para que pueda ser
importado en otros archivos.

================================================================================
CARACTER√çSTICAS PRINCIPALES
================================================================================

1. ASIGNACI√ìN M√öLTIPLE DE ESTUDIANTES
   - Permite seleccionar varios estudiantes mediante checkboxes
   - Crea una tarea duplicada para cada estudiante seleccionado
   - Mantiene compatibilidad con el backend que solo soporta un estudiante
     por tarea

2. GESTI√ìN DE ETIQUETAS
   - Permite seleccionar m√∫ltiples etiquetas existentes
   - Permite crear nuevas etiquetas con nombre y color personalizado
   - Muestra iconos para etiquetas predefinidas

3. TEMA ADAPTATIVO
   - Todos los estilos se adaptan al tema claro/oscuro
   - Usa el hook useTheme para obtener el estado del tema

4. VALIDACIONES
   - Valida que el t√≠tulo no est√© vac√≠o antes de crear
   - Valida que haya boardId antes de crear etiquetas
   - Maneja errores de forma amigable con mensajes al usuario

5. SINCRONIZACI√ìN CON BACKEND
   - Crea las tareas en el backend usando la API
   - Actualiza el estado local inmediatamente
   - Notifica al componente padre para recargar desde el backend

================================================================================
FIN DE LA DOCUMENTACI√ìN
================================================================================

